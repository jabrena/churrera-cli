@startuml
!theme plain
title Complete Project - Class Diagram (All Modules)

!define CHURRERA_CLI package "churrera-cli" #LightBlue
!define CHURRERA_CORE package "churrera-core" #LightGreen
!define CURSOR_CLIENT package "cursor-cloud-agents-client" #LightYellow
!define CURSOR_OPENAPI package "cursor-cloud-agents-openapi" #LightCoral

CHURRERA_CLI {
  [ChurreraCLI] as CLI
  [CliCommand] as CliCmd
  [RunCommand] as RunCmd
  [JobProcessor] as JobProc
  [CLIAgent] as CLIAgent
  [JobRepository] as JobRepo
  [Job] as Job
  [Prompt] as Prompt
  [SequenceWorkflowHandler] as SeqHandler
  [ParallelWorkflowHandler] as ParHandler
  [ChildWorkflowHandler] as ChildHandler
}

CHURRERA_CORE {
  [WorkflowParser] as WFParser
  [WorkflowData] as WFData
  [WorkflowValidator] as WFValidator
  [PmlValidator] as PmlValidator
  [WorkflowType] as WFType
  [PromptInfo] as PromptInfo
  [PropertyResolver] as PropResolver
  [CursorApiKeyResolver] as ApiKeyResolver
  [PmlConverter] as PmlConverter
  [ExpressionEvaluator] as ExprEval
}

CURSOR_CLIENT {
  [CursorAgentManagement] as AgentMgmt
  [CursorAgentInformation] as AgentInfo
  [CursorAgentGeneralEndpoints] as AgentGen
  [CursorAgentManagementImpl] as AgentMgmtImpl
  [CursorAgentInformationImpl] as AgentInfoImpl
  [CursorAgentGeneralEndpointsImpl] as AgentGenImpl
  [AgentResponse] as AgentResp
  [AgentStatus] as AgentStatus
  [ConversationResponse] as ConvResp
}

CURSOR_OPENAPI {
  [OpenAPISpecification] as OpenAPI
}

' Main relationships
CLI --> JobRepo
CLI --> CLIAgent
CLI --> JobProc
CLI --> WFParser
CLI --> WFValidator

CliCmd --> JobRepo
CliCmd --> JobProc
CliCmd --> CLIAgent

RunCmd --> JobRepo
RunCmd --> JobProc

JobProc --> JobRepo
JobProc --> CLIAgent
JobProc --> SeqHandler
JobProc --> ParHandler
JobProc --> ChildHandler
JobProc --> WFParser

SeqHandler --> CLIAgent
ParHandler --> CLIAgent
ChildHandler --> CLIAgent

CLIAgent --> AgentMgmt
CLIAgent --> AgentInfo
CLIAgent --> AgentGen
CLIAgent --> JobRepo
CLIAgent --> PmlConverter
CLIAgent --> PropResolver
CLIAgent --> ExprEval

AgentMgmtImpl ..|> AgentMgmt
AgentInfoImpl ..|> AgentInfo
AgentGenImpl ..|> AgentGen

AgentMgmtImpl --> AgentResp
AgentInfoImpl --> AgentResp
AgentInfoImpl --> ConvResp

AgentResp --> AgentStatus

JobRepo --> Job
JobRepo --> Prompt

Job --> AgentStatus
Job --> WFType

WFParser --> WFData
WFParser --> WFType
WFParser --> PromptInfo

WFData --> PromptInfo
WFData --> WFType

WFValidator --> WFParser
PmlValidator --> WFParser

note right of CLI
  Main CLI application
  Entry point for all commands
end note

note right of JobProc
  Background processor
  Handles job execution workflows
end note

note right of CLIAgent
  Service layer for
  Cursor API interactions
end note

note right of WFParser
  Parses workflow XML files
  Supports sequence and parallel workflows
end note

note right of AgentMgmt
  Interface for agent
  lifecycle management
end note

@enduml
