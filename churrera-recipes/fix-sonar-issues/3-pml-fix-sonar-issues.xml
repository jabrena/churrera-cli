<?xml version="1.0" encoding="UTF-8"?>
<prompt xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="https://jabrena.github.io/pml/schemas/0.3.0/pml.xsd">

    <title>Fix Sonar issues for the project</title>

    <role>You are a Senior software engineer with extensive experience in Java software development</role>

    <goal>
        Fix Sonar issues for the project.
        Follow the next steps to achieve the goal.
    </goal>

    <steps>
        <step number="1">
            <step-title>Download Sonar issues for the project</step-title>
            <step-content>
                Retrieve the list of Sonar issues for the project using the following command:

                <![CDATA[
                ```bash
                jbang sonar-search.0.2.0-SNAPSHOT@jabrena \
                --project jabrena_churrera-cli --query issues \
                --types all  --severity major --status open --size 400 --quiet
                ```
                ]]>

                The output is a JSON format with the list of issues and it has the following
                structure:

                ```json
                {
                "total" : 0,
                "p" : 1,
                "ps" : 5,
                "paging" : {
                "pageIndex" : 1,
                "pageSize" : 5,
                "total" : 0
                },
                "effortTotal" : 0,
                "debtTotal" : 0,
                "issues" : [ ],
                "components" : [ ],
                "organizations" : [ ],
                "facets" : [ ]
                }
                ```

                and understand the issues node exist an array of issues.
                you need to put focus per issue object in the following object attributes:

                <![CDATA[
                ```json
                component : jabrena_churrera-cli:churrera-cli/src/main/java/info/jab/churrera/cli/command/run/JobDisplayService.java
                project : jabrena_churrera-cli
                rule : java:S1192
                line : 76
                flows : [ ]
                message : Define a constant instead of duplicating this literal \"Unknown\" 3 times.
                ```
                ]]>

                the field message indicate what is the issue,
                the field component indicate where is the issue located,
                in the section "flows" offer details where the issue is located.
                if flows has multiple objects, offer details about locations where the issue is located.
            </step-content>
        </step>
        <step number="2">
            <step-title>Fix the Sonar issues</step-title>
            <step-content>
                Using that information, fix the project in the different maven modules.

                Verify the changes with:

                ```bash
                ./mvnw clean test verify site -Pjacoco
                ```

                Once the changes are verified,
                commit the changes and push the changes to the branch to create the PR.
            </step-content>
            <step-constraints>
                <step-constraint-list>
                    <step-constraint>Not any issue which is has the rule: java:S3776 (Cognitive Complexity of methods should not be too high)</step-constraint>
                    <step-constraint>Not any issue which is has the rule: java:S106 (Replace this use of System.out by a logger)</step-constraint>
                    <step-constraint>Not any issue which is has the rule: java:S112 (Replace generic exceptions with specific library exceptions or a custom exception.)</step-constraint>
                    <step-constraint>Not any issue which is has the rule: java:S107 (Methods should not have too many parameters)</step-constraint>
                </step-constraint-list>
            </step-constraints>
        </step>
    </steps>

    <output-format>
        <output-format-list>
            <output-format-item>Print the list of sonar issues with the following format per issue:
                component:
                rule:
                message:
                ---
            </output-format-item>
        </output-format-list>
    </output-format>

    <safeguards>
        <safeguards-list>
            <safeguards-item>verify the changes only with `./mvnw clean test verify site -Pjacoco`</safeguards-item>
            <safeguards-item>verify the changes exectuting the command:
                <![CDATA[
                ```bash
                java -jar churrera-cli/target/churrera-cli-0.2.0-SNAPSHOT.jar run \
                --workflow churrera-cli/src/test/resources/examples/hello-world-bash/workflow-hello-world.xml \
                --delete-on-success-completion --polling-interval 10
                ```
                ]]>
            </safeguards-item>
        </safeguards-list>
    </safeguards>

    <acceptance-criteria>
        <acceptance-criteria-list>
            <acceptance-criteria-item>The Sonar issues are fixed</acceptance-criteria-item>
            <acceptance-criteria-item>The project is verified successfully with `./mvnw clean test verify site -Pjacoco`</acceptance-criteria-item>
            <acceptance-criteria-item>The project is verified successfully if the executing the jar, the workflow is executed successfully.</acceptance-criteria-item>
            <acceptance-criteria-item>The changes are committed and pushed to the branch to create the PR</acceptance-criteria-item>
        </acceptance-criteria-list>
    </acceptance-criteria>
</prompt>
